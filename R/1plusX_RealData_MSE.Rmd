---
title: "R Notebook"
output: html_notebook
---


```{r setup, include=TRUE, echo=FALSE}
library(ggplot2)
library(scales)
library(gridExtra)

path = "~/Documents/ETH/Thesis/1plusX/Data/Thesis/1plusx/Results/MSE/"
plot_results <- function(algorith_name="Random") {
  
  data <- read.csv(file=paste0(path, paste0(algorith_name, ".csv")), header=TRUE, sep=",")
  data$Percent = data$Clicks / data$Impressions * 100
  data$Factor = paste(data$Method, sep=" ")

  ggplot(data, aes(x=TotalImpressions, y=MSE, colour=Factor)) + 
     geom_line() +
#    stat_smooth(aes(x = TotalImpressions, y =MSE), method = "lm",
 #               formula = y ~ poly(x, 2), se = FALSE) +
    xlab("Impressions") + ylab("% of Clicks") +
    #expand_limits(y=c(4,7.5), x=c(0, 225000)) + 
    theme_bw() + ggtitle(algorith_name)
}

formatterM <- function(){
  function(x) paste(x/1000000, "M")
}

formatterPretty <- function(){
  function(x) ifelse(x==10, paste(x, "% (Random)"), paste(x, "%"))
}

selectNecessaryColumns <- function(df, columns) {
  for (column in columns) {
    if(!(column %in% colnames(df))){
      df[column] = NA
    } 
  }
  df[,columns]
}

prepData <- function(files) {
  data <- read.csv(file=paste0(path, paste0("LinUCB_Disjoint", ".csv")), header=TRUE, sep=",")
  columns = c("MSE", "Impressions", "CumulativeMSE", "RecommendationSizePercent","TotalImpressions","Method", "Alpha","Timestamp")
  data = selectNecessaryColumns(data, columns)
  for (name in files){
    data1 <- read.csv(file=paste0(path, paste0(name, ".csv")), header=TRUE, sep=",")
    data1 = selectNecessaryColumns(data1, columns)
    data <- rbind(data, data1)  
  }
  
  data$Factor = factor(paste(data$Method, data$Alpha, data$RecommendationSizePercent * 100))
  data$UserPercentage = factor(data$RecommendationSizePercent * 100)
  #data$Timestamp = data$Timestamp / 1000
  data$Timestamp = as.POSIXct(data$Timestamp, origin="1970-01-01")
  data
}
  
```

```{r Random, include=TRUE, echo=FALSE}

files = c("NN")
data = prepData(files)
ggplot(data, aes(x=TotalImpressions, y=CumulativeMSE, colour=Factor)) + 
  geom_line() +
 #     stat_smooth(aes(x=TotalImpressions, y=MSE), method = "lm", formula = y ~ poly(x, 10), se = FALSE) +
    xlab("Impressions") + ylab("% of Clicks") +
   # expand_limits(y=c(0,0.1)) +
  #+ 
  #scale_y_log10()+
    #scale_x_continuous(labels=formatterM())+
    theme_bw() + ggtitle("Regression 4h (Cumulative)") +
    scale_color_discrete(name="User Percentage", labels=formatterPretty())

```
